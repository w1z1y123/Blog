---
desc: "缓冲区溢出攻击"
tags: "网络与系统攻击技术"
outline: deep
---

# 缓冲区溢出攻击

## 相关概念

### 缓冲区

应用程序用来保存用户输入数据、程序临时数据的内存空间

**缓冲区溢出**

如果用户输入的数据长度超出了程序为其分配的内存空间，这些数据就会覆盖程序为其它数据分配的内存空间，形成所谓的缓冲区溢出

**溢出的后果**
- 过长的字符串覆盖了相邻的存储单元，引起了程序运行失败，严重可导致系统崩溃
- 利用这种漏洞可以执行任意指令，甚至可以取得系统root权限

## 缓冲区溢出原理

**PEB&TEB**

PEB 初始化位置位于 `0X7FFDF000`(用户地址空间)

TEB 存放在从`0X7FFDE000`开始的线性内存中，每4KB为一个完整的TEB


**栈**

- 栈是一块连续的内存空间，先入后入
- 生长方向与内存的生长方向正好相反，从高地址向低地址生长

使用POP/PUSH指令对栈进行操作，使用ESP寄存器指向栈顶，EBP指向当前函数栈帧的基址            


## 缓冲区溢出的原理以及利用

### 缓冲区溢出的种类

**栈溢出**
- 拷贝的数据过长
- 覆盖了函数返回地址或者一些其他的重要的数据结构、函数指针

**堆溢出**


覆盖了堆管理结构


**整形溢出**

计算机中整数都有一个宽度（本文中为32位），因此它就有一个可以表示的最大值。当我们试图保存一个比它可以表示的最大值还大的数时，就会发生整数溢出

- 宽度溢出
- 运算溢出
- 符号溢出
  
**格式化字符串溢出**

- 在程序员试图传递一个字符串到一个使用格式化字符的格式函数中，就可能发生溢出情况


**其他溢出**

- Data section 溢出
- PEB/TEB 溢出
- 文件流溢出

### shellcode

利用软件漏洞的代码，它通常被设计为在目标系统上执行命令行shell，从而允许攻击者对系统进行控制

## 安全编程技术

### 设计安全系统
- 建立一个安全步骤
- 定义产品的安全目标
- 将安全看成产品的一个功能
- 从错误中吸取教训
- 使用最小权限
- 使用纵深防御
- 假设外部系统是不安全的
- 做好失效的计划
- 使用安全的默认值

**威胁模型**
- 欺骗标识(认证、保护秘密、不存储密码)
- 篡改数据(授权、消息认证码、数字签名)
- 拒绝履约(数字签名、时间戳)
- 信息披露(加密)
- 拒绝服务(认证、授权、过滤)
- 特权提升(以最小权限运行)